FROM node:18-alpine

ARG FIREBASE_API_KEY
ENV FIREBASE_API_KEY=${FIREBASE_API_KEY}

ARG FIREBASE_AUTH_DOMAIN
ENV FIREBASE_AUTH_DOMAIN=${FIREBASE_AUTH_DOMAIN}

ARG FIREBASE_PROJECT_ID
ENV FIREBASE_PROJECT_ID=${FIREBASE_PROJECT_ID}

ARG FIREBASE_STORAGE_BUCKET
ENV FIREBASE_STORAGE_BUCKET=${FIREBASE_STORAGE_BUCKET}

ARG FIREBASE_MESSAGING_SENDER_ID
ENV FIREBASE_MESSAGING_SENDER_ID=${FIREBASE_MESSAGING_SENDER_ID}

ARG FIREBASE_APP_ID
ENV FIREBASE_APP_ID=${FIREBASE_APP_ID}

ARG FIREBASE_MEASUREMENT_ID
ENV FIREBASE_MEASUREMENT_ID=${FIREBASE_MEASUREMENT_ID}

ARG FUNCTIONS_URL
ENV FUNCTIONS_URL=${FUNCTIONS_URL}

ARG WORKDIR=/app
WORKDIR ${WORKDIR}

RUN echo ${FIREBASE_APP_ID}

ENV NUXT_HOST=0.0.0.0 \
	NUXT_PORT=3000

RUN apk add --update --no-cache \
	git \
	yarn

COPY package.json yarn.lock ${WORKDIR}/
RUN yarn install

COPY . ${WORKDIR}
RUN yarn build

EXPOSE 3000
ENTRYPOINT [ "./docker-entrypoint.sh" ]
CMD ["preview"]
